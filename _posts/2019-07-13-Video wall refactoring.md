---
layout: post
title: 电视墙控制重构
date: '2019-07-13 14:41'
categories: 
 - 工作记录
tags:
 - 优化
 - 电视墙
---

# 当前设计

1. 电视墙控制类：单例模式
2. 在客户端主界面点击电视墙后会去和矩阵建立连接，并同步数据。
3. 关闭电视墙页面后，将会断开矩阵的连接。

# 目前的缺陷

1. 每次打开电视墙界面都会重新去建立矩阵的连接。
2. 与电视墙去同步的时候只会同步本级的设备。
3. 电视墙初始化的时间较长
4. 无法兼容多个版本的sdk

# 需求

1. 抽象一层电视墙控制，为了兼容不同的sdk
2. [可以在客户端修改电视墙对接矩阵sdk的版本]
3. 在主界面添加一个控制电视墙的按钮
4. 设备树添加一种颜色来表示是否已经和电视墙同步了
5. 抽象的电视墙控制类使用单例模式，跑在一个线程中
6. 实现可以同步下级设备信息

# 实现

## 电视墙初始化流程

1. 获取矩阵主机host，如果不存在则循环等待。
2. 连接矩阵，如果连接失败，则循环连接。
3. 获取板卡信息

## 电视墙控制抽象类

```cpp
class TFVideoWallFactory: QThread{
  Q_OBJECT
};
```

# 中断

在考虑了时间成本后，将本设计中断，将在原有的基础上做修改和添加。