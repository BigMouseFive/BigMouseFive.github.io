{"compress":true,"commitItems":[["cd22c370-3cf7-4709-8c0c-6a1f15ffc666",1552481224916,"改价策略\n=\n* 情况分析：\n  * 当**购物车价格**小于**当前定价**，**降价比**不超过**设定值**，设置价格为【**购物车价格**-**降价值**】\n  * 当**购物车价格**小于**当前定价**，**降价比**超过**设定值**，不改价\n  * 当**购物车价格**等于**当前定价**，不改价\n  * 当**购物车价格**大于**当前定价**，不改价\n\n\n改价程序流程\n=\n* 启动chrome浏览器 \n\n```python\nchrome=webdriver.Chrome(executable_path=chromePath, chrome_options=option)\n```\n\n* 打开卖家登录界面[seller-login](https://uae.souq.com/ae-en/account.php)\n\n```\n# 获取email 和 password 控件\n    print(\"登录账户\")\n    chrome.get(loginUri)\n    try:\n        elemNewAccount = chrome.find_element_by_id(\"email\")\n        elemNewLoginBtn = chrome.find_element_by_id(\"siteLogin\")\n        elemNewAccount.send_keys(account)\n        print(\"输入账户:\" + account)\n        elemNewLoginBtn.click()\n        print(\"点击siteLogin\")\n        try:\n            cssSelectText = \"#continue\"\n            WebDriverWait(chrome, 10, 0.5).until(EC.presence_of_element_located((By.CSS_SELECTOR, cssSelectText)))\n            print(\"获取到continue按钮\")\n            elemContinue = chrome.find_element_by_id(\"continue\")\n            elemContinue.click()\n            print(\"点击continue\")\n            cssSelectText = \"#ap_password\"\n            WebDriverWait(chrome, 20, 0.5).until(EC.presence_of_element_located((By.CSS_SELECTOR, cssSelectText)))\n            print(\"获取到password输入框\")\n            elemPassword = chrome.find_element_by_id(\"ap_password\")\n            elemLoginBtn = chrome.find_element_by_id(\"signInSubmit\")\n            elemPassword.send_keys(Keys.CONTROL + \"a\")\n            elemPassword.send_keys(password)\n            print(\"输入密码：********\")\n            elemLoginBtn.click()\n            print(\"点击continue\")\n        except:\n            print(\"方式一登录失败，尝试方式二登录\")\n            cssSelectText = \"#password\"\n            WebDriverWait(chrome, 20, 0.5).until(EC.presence_of_element_located((By.CSS_SELECTOR, cssSelectText)))\n            print(\"获取到password输入框\")\n            elemPassword = chrome.find_element_by_id(\"password\")\n            elemLoginBtn = chrome.find_element_by_id(\"siteLogin\")\n            elemPassword.clear()\n            elemPassword.send_keys(password)\n            print(\"输入密码：********\")\n            elemLoginBtn.click()\n            print(\"点击登录\")\n\n        cssSelectText = \"#search_box\"\n        WebDriverWait(chrome, 20, 0.5).until(EC.presence_of_element_located((By.CSS_SELECTOR, cssSelectText)))\n    except:\n        if str(chrome.current_url).find(\"uae.souq.com/ae-en/account.php\") < 0:\n            raise\n```\n\n* 登入成功后打开[fbs-inventory](https://sell.souq.com/fbs-inventory)\n\n```\nloginHandler = chrome.current_window_handle\n    handlers = chrome.window_handles\n    unknownHandler = \"\"\n    for handler in handlers:\n        if handler != loginHandler:\n            unknownHandler = handler\n            break\n    readyUri = \"https://sell.souq.com/fbs-inventory\"\n    js = 'window.open(\"' + readyUri + '\")'\n    chrome.execute_script(js)\n    handlers = chrome.window_handles\n    for handler in handlers:\n        if handler != loginHandler and handler != unknownHandler:\n            inventoryHandler = handler\n            break\n    print(\"跳转到改价界面\")\n    while 1:\n        try:\n            chrome.switch_to_window(inventoryHandler)\n            print(\"开始循环处理\")\n            OperateProduct(chrome, record, attention, percent, lowwer)\n        except:\n            print(\"循环改价发生错误，马上重新开始\")\n        print(\"刷新改价界面\")\n        chrome.refresh()\n```\n\n* 开始循环改价\n  * 获取商品列表的第一行 **first_row**\n\n```python\n first_row = chrome.find_elements_by_css_selector('//*[@id=\"table-inventory\"]/tbody/tr[1]')\n```\n\n  * 点击第一行 \n  \n```python\nchrome.execute_script(\"arguments[0].click()\", first_row)\n```\n\n  * 循环改价操作\n   \n![chagePriceOperate](chagePriceOperate.png)\n\n```python\n    i = 0\n    while 1:\n        WebDriverWait(chrome, 60, 0.5).until(checkPage)\n        gold_price = 0\n\n        # 获取EAN\n        ean_elem = chrome.find_element_by_xpath('//*[@id=\"offerListitng\"]/div[2]/div/div[1]/div[1]/span')\n        ean = ean_elem.text.split(\";\")[-1]\n        timestr = time.strftime(\"%Y-%m-%d %H:%M:%S\")\n\n        # 获取当前价格输入框，并获取当前价格\n        self_price_elem = chrome.find_element_by_xpath(\n            '//*[@id=\"offerListitng\"]/div[4]/div[2]/div/div/div/div[1]/sc-offer-listing/div/div[1]/label[2]/input')\n        self_price = float(self_price_elem.get_attribute(\"value\"))\n\n        # 获取购物车价格\n        try:\n            gold_price_elem = chrome.find_element_by_xpath('//*[@id=\"offerListitng\"]/div[4]/div[2]/div/div/div/div[1]/sc-offer-listing/div/div[1]/label[2]/small[1]/span[2]')\n            gold_price = float(re.findall(r\"\\d+\\.?\\d*\", gold_price_elem.text)[0])\n        except NoSuchElementException:\n            i += 1\n            out = str(i) + \"-->\" + timestr + \" \" + ean + \"\\t只有本店铺一家卖此产品\"\n            print(out)\n        out = timestr + \" \" + ean + \"\\t购物车：\" + str(gold_price) + \"\\t本店铺：\" + str(self_price) + \"\\t降价比:\" + str(\n            round((self_price - gold_price) / self_price, 2) * 100) + \"%\"\n\n        # 判断\n        # if 购物车价格 小于 当前定价 and 降价比 不超过 设定值:\n        if gold_price < self_price and ((self_price-gold_price)/self_price) <= percent:\n            # 修改当前价格输入框的中价格为【购物车价格-降价值】\n            to_price = round(gold_price - lowwer, 2)\n            self_price_elem.send_keys(Keys.CONTROL + \"a\")\n            self_price_elem.send_keys(str(to_price))\n            # 获取按钮【更新】，并点击\n            update_elem = chrome.find_element_by_xpath('//*[@id=\"offerListitng\"]/div[3]/div/div/input')\n            chrome.execute_script(\"arguments[0].click()\", update_elem)\n            out += \"\\t修改价格：\" + str(to_price) + \"\\n\"\n            record.write(out)\n            record.flush()\n        else:\n            out += \"\\t不处理\\n\"\n            attention.write(out)\n            attention.flush()\n        out = out[0:-1]\n        i += 1\n        out = str(i) + \"-->\" + out\n        print(out)\n        # 获取按钮【下一个】，并点击\n        path = '//*[@id=\"offerListitng\"]/div[3]/div/div/div/div/div/a[2]'\n        WebDriverWait(chrome, 20, 0.5).until(EC.presence_of_element_located((By.XPATH, path)))\n        next_elem = chrome.find_element_by_xpath(path)\n        if next_elem.get_attribute(\"class\") == \"button-disabled\":\n            print(\"完成一次循环\")\n            raise IndexError\n        chrome.execute_script(\"arguments[0].click()\", next_elem)\n        time.sleep(0.5)\n```\n\n总结\n=\n* 如何使用xpath\n* 如何判断网页已全部加载完成\n* 如何请空**INPUT框**的内容\n* python+selenium开发基本过程\n\n",[[1552481223004,["79054@DESKTOP-05FPSNP",[[1,0,"\n"]],[0,0],[1,1]]],[1552481223676,["79054@DESKTOP-05FPSNP",[[1,0,"---\nlayout: post\ntitle: 记一次内存泄漏\ndate: '2019-03-12 20:53'\ncategories: document\ntag: 教程\n---"]],[0,0],[89,89]]],[1552481264661,["79054@DESKTOP-05FPSNP",[[-1,48,"2"]],[47,47],[48,48]]],[1552481264896,["79054@DESKTOP-05FPSNP",[[1,48,"3"]],[48,48],[49,49]]],[1552481274322,["79054@DESKTOP-05FPSNP",[[-1,69,"document"]],[69,77],[69,69]]],[1552481289795,["79054@DESKTOP-05FPSNP",[[1,69,"工作记录"]],[69,69],[73,73]]],[1552481300577,["79054@DESKTOP-05FPSNP",[[-1,79,"教程"],[1,81,"自动改价"]],[79,79],[83,83]]],[1552481304724,["79054@DESKTOP-05FPSNP",[[1,83,"器"]],[83,83],[84,84]]],[1552481306042,["79054@DESKTOP-05FPSNP",[[-1,83,"器"]],[84,84],[83,83]]],[1552481307251,["79054@DESKTOP-05FPSNP",[[1,83,"程序"]],[83,83],[85,85]]],[1552481322526,["79054@DESKTOP-05FPSNP",[[1,3658,"/"]],[3658,3658],[3659,3659]]],[1552481328988,["79054@DESKTOP-05FPSNP",[[1,3658,"styles"]],[3658,3658],[3664,3664]]],[1552481329353,["79054@DESKTOP-05FPSNP",[[1,3665,"/"]],[3664,3664],[3665,3665]]],[1552481332807,["79054@DESKTOP-05FPSNP",[[1,3665,"images"]],[3665,3665],[3671,3671]]],[1552481339029,["79054@DESKTOP-05FPSNP",[[1,3658,"/"]],[3658,3658],[3659,3659]]],[1552481579847,["79054@DESKTOP-05FPSNP",[[-1,6253," 如何使用"]],[6258,6258],[6253,6253]]],[1552481580744,["79054@DESKTOP-05FPSNP",[[1,6253," "]],[6253,6253],[6254,6254]]],[1552481582751,["79054@DESKTOP-05FPSNP",[[1,6259,"de"]],[6259,6259],[6261,6261]]],[1552481583346,["79054@DESKTOP-05FPSNP",[[-1,6259,"de"]],[6261,6261],[6259,6259]]],[1552481584935,["79054@DESKTOP-05FPSNP",[[1,6259,"的使用"]],[6259,6259],[6262,6262]]],[1552481588765,["79054@DESKTOP-05FPSNP",[[-1,6265,"如何"]],[6267,6267],[6265,6265]]],[1552481592428,["79054@DESKTOP-05FPSNP",[[-1,6279,"如何"]],[6281,6281],[6279,6279]]],[1552481593193,["79054@DESKTOP-05FPSNP",[[1,6297,"\n* "]],[6294,6294],[6297,6297]]],[1552481594299,["79054@DESKTOP-05FPSNP",[[1,6295,"  "]],[6297,6297],[6299,6299]]],[1552481597243,["79054@DESKTOP-05FPSNP",[[-1,6296," * "]],[6299,6299],[6296,6296]]],[1552481597673,["79054@DESKTOP-05FPSNP",[[1,6296,"  "]],[6296,6296],[6298,6298]]],[1552481599118,["79054@DESKTOP-05FPSNP",[[-1,6295,"   "]],[6298,6298],[6295,6295]]],[1552481599515,["79054@DESKTOP-05FPSNP",[[-1,6295,"\n"]],[6295,6295],[6294,6294]]],[1552481599861,["79054@DESKTOP-05FPSNP",[[1,6297,"\n* "]],[6294,6294],[6297,6297]]],[1552481602712,["79054@DESKTOP-05FPSNP",[[1,6295,"  "]],[6297,6297],[6299,6299]]],[1552481615348,["79054@DESKTOP-05FPSNP",[[1,6299,"可以先"]],[6299,6299],[6302,6302]]],[1552481616039,["79054@DESKTOP-05FPSNP",[[-1,6299,"可以先"]],[6302,6302],[6299,6299]]],[1552481617100,["79054@DESKTOP-05FPSNP",[[1,6299,"获取"]],[6299,6299],[6301,6301]]],[1552481618104,["79054@DESKTOP-05FPSNP",[[-1,6299,"获取"]],[6301,6301],[6299,6299]]],[1552481628864,["79054@DESKTOP-05FPSNP",[[1,6299,"假设"]],[6299,6299],[6301,6301]]],[1552481631759,["79054@DESKTOP-05FPSNP",[[-1,6299,"假设"]],[6301,6301],[6299,6299]]],[1552481637685,["79054@DESKTOP-05FPSNP",[[1,6299,"input_elem->"]],[6299,6299],[6311,6311]]],[1552481638158,["79054@DESKTOP-05FPSNP",[[-1,6309,"->"]],[6311,6311],[6309,6309]]],[1552481639953,["79054@DESKTOP-05FPSNP",[[1,6309,".clear();"]],[6309,6309],[6318,6318]]],[1552481640702,["79054@DESKTOP-05FPSNP",[[-1,6317,";"]],[6318,6318],[6317,6317]]],[1552481641437,["79054@DESKTOP-05FPSNP",[[1,6317,";"]],[6317,6317],[6318,6318]]],[1552481644789,["79054@DESKTOP-05FPSNP",[[-1,6297,"* "]],[6299,6299],[6297,6297]]],[1552481645655,["79054@DESKTOP-05FPSNP",[[1,6297,"\\"]],[6297,6297],[6298,6298]]],[1552481647779,["79054@DESKTOP-05FPSNP",[[-1,6296," \\input_elem.clear();"]],[6298,6298],[6296,6296]]],[1552482018136,["79054@DESKTOP-05FPSNP",[[1,6296," "]],[6296,6296],[6297,6297]]],[1552482020156,["79054@DESKTOP-05FPSNP",[[1,6298,"\n```python\n# 方法一：使用clear清空\ninput_elem.clear()\ninput_elem.send_keys(content)\n# 方法二:\ninput_elem.send_keys(Keys.CONTROL + \"a\")\n\n```\n\n"]],[6297,6297],[6428,6428]]],[1552482082401,["79054@DESKTOP-05FPSNP",[[-1,6295,"  "]],[6297,6297],[6295,6295]]],[1552482082870,["79054@DESKTOP-05FPSNP",[[-1,6296,"\n"]],[6295,6295],[6294,6294]]],[1552482095689,["79054@DESKTOP-05FPSNP",[[1,6419,"input_elem.send_keys()"]],[6419,6419],[6441,6441]]],[1552482097510,["79054@DESKTOP-05FPSNP",[[1,6440,"Keys."]],[6440,6440],[6445,6445]]],[1552482098969,["79054@DESKTOP-05FPSNP",[[-1,6439,"(Keys."]],[6445,6445],[6439,6439]]],[1552482101427,["79054@DESKTOP-05FPSNP",[[1,6439,"(contene"]],[6439,6439],[6447,6447]]],[1552482101769,["79054@DESKTOP-05FPSNP",[[-1,6446,"e"]],[6447,6447],[6446,6446]]],[1552482101845,["79054@DESKTOP-05FPSNP",[[1,6446,"t"]],[6446,6446],[6447,6447]]],[1552482104742,["79054@DESKTOP-05FPSNP",[[1,6362,"\""]],[6362,6362],[6363,6363]]],[1552482105824,["79054@DESKTOP-05FPSNP",[[1,6370,"\""]],[6370,6370],[6371,6371]]],[1552482106881,["79054@DESKTOP-05FPSNP",[[1,6442,"\""]],[6442,6442],[6443,6443]]],[1552482107663,["79054@DESKTOP-05FPSNP",[[1,6450,"\""]],[6450,6450],[6451,6451]]],[1552482113626,["79054@DESKTOP-05FPSNP",[[1,6482,"  "]],[6482,6482],[6484,6484]]],[1552482114358,["79054@DESKTOP-05FPSNP",[[-1,6483," "]],[6484,6484],[6483,6483]]],[1552482114749,["79054@DESKTOP-05FPSNP",[[1,6483,"  "]],[6483,6483],[6485,6485]]],[1552482116157,["79054@DESKTOP-05FPSNP",[[-1,6482,"   "]],[6485,6485],[6482,6482]]],[1552482117524,["79054@DESKTOP-05FPSNP",[[1,6482,"    "]],[6482,6482],[6486,6486]]],[1552482118815,["79054@DESKTOP-05FPSNP",[[-1,6482,"    "]],[6486,6486],[6482,6482]]],[1552482121994,["79054@DESKTOP-05FPSNP",[[1,6482,"    xia"]],[6482,6482],[6489,6489]]],[1552482122561,["79054@DESKTOP-05FPSNP",[[-1,6486,"xia"]],[6489,6489],[6486,6486]]],[1552482127771,["79054@DESKTOP-05FPSNP",[[1,6486,"首先，对"]],[6486,6486],[6490,6490]]],[1552482128778,["79054@DESKTOP-05FPSNP",[[-1,6486,"首先，对"]],[6490,6490],[6486,6486]]],[1552482132049,["79054@DESKTOP-05FPSNP",[[1,6486,"首先，"]],[6486,6486],[6489,6489]]],[1552482133927,["79054@DESKTOP-05FPSNP",[[-1,6485," 首先，"]],[6489,6489],[6485,6485]]],[1552482134945,["79054@DESKTOP-05FPSNP",[[-1,6481,"\n"]],[6482,6482],[6481,6481]]],[1552482135119,["79054@DESKTOP-05FPSNP",[[-1,6480,"程"]],[6481,6481],[6480,6480]]],[1552482137527,["79054@DESKTOP-05FPSNP",[[1,6480,"程"]],[6480,6480],[6481,6481]]],[1552482188176,["79054@DESKTOP-05FPSNP",[[-1,95,"="]],[96,96],[95,95]]],[1552482189481,["79054@DESKTOP-05FPSNP",[[1,90,"#"]],[90,90],[91,91]]],[1552482203067,["79054@DESKTOP-05FPSNP",[[1,91," "]],[91,91],[92,92]]],[1552482206313,["79054@DESKTOP-05FPSNP",[[-1,287,"="]],[288,288],[287,287]]],[1552482207801,["79054@DESKTOP-05FPSNP",[[1,280,"# "]],[280,280],[282,282]]],[1552482213526,["79054@DESKTOP-05FPSNP",[[-1,6252,"="]],[6253,6253],[6252,6252]]],[1552482214833,["79054@DESKTOP-05FPSNP",[[1,6249,"# "]],[6249,6249],[6251,6251]]],[1552482219967,["79054@DESKTOP-05FPSNP",[[1,6282,"\n* "]],[6279,6279],[6282,6282]]],[1552482221890,["79054@DESKTOP-05FPSNP",[[-1,6280,"* "]],[6282,6282],[6280,6280]]],[1552482261739,["79054@DESKTOP-05FPSNP",[[1,6281,"```\ndef checkPage(driver):\n    checkPageFinishScript = \"try {if (document.readyState !== 'complete') {return false;} if (window.jQuery) { if (\" \\\n                            \"window.jQuery.active) { return false; } else if (window.jQuery.ajax && \" \\\n                            \"window.jQuery.ajax.active) { return false; } } if (window.angular) { if (!window.qa) { \" \\\n                            \"window.qa = {doneRendering: false }; } var injector = window.angular.element(\" \\\n                            \"'body').injector(); var $rootScope = injector.get('$rootScope'); var $http = \" \\\n                            \"injector.get('$http'); var $timeout = injector.get('$timeout'); if ($rootScope.$$phase \" \\\n                            \"=== '$apply' || $rootScope.$$phase === '$digest' || $http.pendingRequests.length !== 0) \" \\\n                            \"{ window.qa.doneRendering = false; return false; } if (!window.qa.doneRendering) { \" \\\n                            \"$timeout(function() { window.qa.doneRendering = true;}, 0); return false;}} return \" \\\n                            \"true;} catch (ex) {return false;} \"\n    return driver.execute_script(checkPageFinishScript)\n\nWebDriverWait(chrome, 60, 0.5).until(checkPage)\n```\n\n"]],[6280,6280],[7519,7519]]],[1552482497590,["79054@DESKTOP-05FPSNP",[[1,69,"-"]],[69,69],[70,70]]],[1552482498258,["79054@DESKTOP-05FPSNP",[[-1,69,"-"]],[70,70],[69,69]]],[1552482498543,["79054@DESKTOP-05FPSNP",[[1,69,"\n"]],[69,69],[70,70]]],[1552482501104,["79054@DESKTOP-05FPSNP",[[1,70,"- "]],[70,70],[72,72]]],[1552482503464,["79054@DESKTOP-05FPSNP",[[1,81,"\n"]],[81,81],[82,82]]],[1552482504484,["79054@DESKTOP-05FPSNP",[[1,82,"-"]],[82,82],[83,83]]],[1552482522491,["79054@DESKTOP-05FPSNP",[[-1,70,"- "]],[72,72],[70,70]]],[1552482522725,["79054@DESKTOP-05FPSNP",[[1,70,"  "]],[70,70],[72,72]]],[1552482523468,["79054@DESKTOP-05FPSNP",[[-1,71," "]],[72,72],[71,71]]],[1552482523920,["79054@DESKTOP-05FPSNP",[[1,71," "]],[71,71],[72,72]]],[1552482524608,["79054@DESKTOP-05FPSNP",[[-1,70,"  "]],[72,72],[70,70]]],[1552482526287,["79054@DESKTOP-05FPSNP",[[1,70," - "]],[70,70],[73,73]]],[1552482528198,["79054@DESKTOP-05FPSNP",[[-1,83,"- "]],[85,85],[83,83]]],[1552482529785,["79054@DESKTOP-05FPSNP",[[1,83," - "]],[83,83],[86,86]]],[1552482543886,["79054@DESKTOP-05FPSNP",[[1,81,"s"]],[81,81],[82,82]]],[1552482557889,["79054@DESKTOP-05FPSNP",[[1,94," \n"]],[93,93],[95,95]]],[1552482559159,["79054@DESKTOP-05FPSNP",[[1,95," - "]],[95,95],[98,98]]],[1552482559901,["79054@DESKTOP-05FPSNP",[[-1,96,"- "]],[98,98],[96,96]]],[1552482560077,["79054@DESKTOP-05FPSNP",[[1,96,"-"]],[96,96],[97,97]]],[1552482560765,["79054@DESKTOP-05FPSNP",[[-1,95," -"]],[97,97],[95,95]]],[1552482561532,["79054@DESKTOP-05FPSNP",[[1,95,"- "]],[95,95],[97,97]]],[1552482568528,["79054@DESKTOP-05FPSNP",[[-1,84," - 自动改价程序"]],[84,93],[84,84]]],[1552482568986,["79054@DESKTOP-05FPSNP",[[1,84," - 自动改价程序"]],[84,84],[84,93]]],[1552482569913,["79054@DESKTOP-05FPSNP",[[-1,84," - 自动改价程序"]],[84,93],[84,84]]],[1552482570920,["79054@DESKTOP-05FPSNP",[[1,78," \n"]],[77,77],[79,79]]],[1552482571081,["79054@DESKTOP-05FPSNP",[[1,79," - 自动改价程序"]],[79,79],[88,88]]],[1552482572962,["79054@DESKTOP-05FPSNP",[[-1,79," "]],[80,80],[79,79]]],[1552482576538,["79054@DESKTOP-05FPSNP",[[-1,95," - \n"]],[94,98],[94,94]]],[1552482578099,["79054@DESKTOP-05FPSNP",[[1,94," - "]],[94,94],[97,97]]],[1552482591926,["79054@DESKTOP-05FPSNP",[[-1,94," - "]],[97,97],[94,94]]],[1552482592374,["79054@DESKTOP-05FPSNP",[[-1,94,"\n"]],[94,94],[93,93]]]],null,"79054@DESKTOP-05FPSNP"]]}